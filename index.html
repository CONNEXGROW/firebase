<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Sign-In</title>
    <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth.js"></script>
</head>
<body>
    <h1>Sign In with Email</h1>
    
    <!-- Input for email address -->
    <input type="email" id="emailInput" placeholder="Enter your email" />
    <button id="sendLinkBtn">Send Sign-In Link</button>

    <script>
        // Firebase configuration (ensure you have your Firebase config here)
        const firebaseConfig = {
            apiKey: "AIzaSyA-e4hO_m_AoHPxDz8T3maBU41njDqABWY",
            authDomain: "connexwebinar.firebaseapp.com",
            projectId: "connexwebinar",
            storageBucket: "connexwebinar.appspot.com",
            messagingSenderId: "1027089564725",
            appId: "1:1027089564725:web:8801537b5cc837d8c35d7c",
            measurementId: "G-NQ6HM4YT2H"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Action Code Settings for email sign-in
        const actionCodeSettings = {
            url: 'https://connexgrow.github.io/firebase/finishSignUp', // Update this to your correct URL
            handleCodeInApp: true, // Ensure link is handled in the app
        };

        // Function to send email sign-in link
        function sendSignInLink(email) {
            auth.sendSignInLinkToEmail(email, actionCodeSettings)
                .then(() => {
                    alert('Sign-in link sent to ' + email);
                    // Store the email locally to complete sign-in after user clicks link
                    window.localStorage.setItem('emailForSignIn', email);
                })
                .catch((error) => {
                    console.error('Error sending email:', error);
                    alert(`Error: ${error.message}`);
                });
        }

        // Function to complete sign-in once the link is clicked
        function completeSignIn() {
            // Get the email from localStorage
            const email = window.localStorage.getItem('emailForSignIn');

            if (auth.isSignInWithEmailLink(window.location.href)) {
                if (!email) {
                    // If no email in local storage, ask the user to input the email again
                    email = window.prompt('Please provide your email for confirmation');
                }

                // Complete the sign-in with the link
                auth.signInWithEmailLink(email, window.location.href)
                    .then((result) => {
                        alert('Successfully signed in!');
                        // Clear localStorage
                        window.localStorage.removeItem('emailForSignIn');
                    })
                    .catch((error) => {
                        console.error('Error signing in:', error);
                        alert(`Error: ${error.message}`);
                    });
            }
        }

        // Event listener for the "Send Sign-In Link" button
        window.onload = function() {
            document.getElementById('sendLinkBtn').addEventListener('click', function() {
                const email = document.getElementById('emailInput').value;
                if (email) {
                    sendSignInLink(email);
                } else {
                    alert('Please enter a valid email address.');
                }
            });

            // If the user is returning after clicking the link in the email
            if (auth.isSignInWithEmailLink(window.location.href)) {
                completeSignIn();
            }
        };
    </script>
</body>
</html>
